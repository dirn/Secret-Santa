!function(e){var t=e(window),n=e(document.body),r=e(".navbar").outerHeight(!0)+10;n.scrollspy({target:".xmas-sidebar",offset:r});t.on("load",function(){n.scrollspy("refresh")});e(".xmas-container [href=#]").click(function(e){e.preventDefault()});setTimeout(function(){var t=e(".xmas-sidebar");t.affix({offset:{top:function(){var n=t.offset().top,r=parseInt(t.children(0).css("margin-top"),10),i=e(".xmas-main-nav").height();return this.top=n-i-r}}})},100);setTimeout(function(){e(".xmas-top").affix()},100);e(".xmas-section").on("click","button",function(){var t=e(this),n=t.data("id"),r=1,i="",s="POST";if(t.hasClass("xmas-claim")){i="/claim";var o=t.closest(".xmas-details").find("input[name=quantity]");o.length&&(r=o.val())}else if(t.hasClass("xmas-unclaim"))i="/unclaim";else if(t.hasClass("xmas-purchase")){i="/purchase";s="PUT"}else if(t.hasClass("xmas-return")){i="/return";s="PUT"}e.ajax({url:i,type:s,data:{id:n,quantity:r}}).done(function(e){t.hasClass("xmas-unclaim")&&t.closest(".xmas-section").hasClass("xmas-claims")?t.closest(".xmas-item").fadeOut("slow"):t.closest(".xmas-item").replaceWith(e)})});e(".xmas-wishlist").on("click","button",function(t){var n=e(this),r=n.closest(".xmas-item");if(n.hasClass("btn-add"))return;if(n.hasClass("btn-cancel")){r.find("form").remove();r.find(".btn-group").show();return}t.preventDefault();var s=n.closest(".xmas-wishlist").find("form").attr("action");s+="/"+n.data("id");var o="",u={},a=null;if(n.hasClass("btn-edit")){o="GET";a=function(e){r.find(".btn-group").hide();r.append(e);i(r.find("input[name=quantity]"))}}else if(n.hasClass("btn-update")){o="PUT";u=n.closest("form").serialize();a=function(e){if(e=="OK"){r.find("form").remove();r.find(".btn-group").show()}else r.html(e)}}else if(n.hasClass("btn-delete")){if(!confirm("Are you sure you want to delete "+r.find("h3").html()+"?"))return;o="DELETE";a=function(){r.parent().remove()}}e.ajax({url:s,type:o,data:u}).done(a)});var i=function(t){var n=e(t),r=n.closest("form").find("input[name=id]").val(),i=e("<p/>");i.insertAfter(n.parent());var s=e('<label for="qty-unlimited-'+r+'">Give me a lot!</label>');i.append(s);var o=e('<input type="checkbox" name="unlimited" id="qty-unlimited-'+r+'">');i.append(o);o.change(function(){if(o.is(":checked")){o.data("original",n.val());n.hide();n.val(0)}else{n.val(o.data("original"));n.show()}});if(n.val()==="0"){o.attr("checked",!0);o.change()}};e(".xmas-wishlist input[name=quantity]").each(function(){i(this)})}(window.jQuery);